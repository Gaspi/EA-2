
\documentclass[12pt,a4paper,titlepage]{article}

\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage[left=1.5cm,right=2cm,top=2cm,bottom=2cm]{geometry}

\input{defines}

% \newcommand{\GF}[1]{\text{GF}(#1)}
\newcommand{\GF}[1]{\F_{#1}}


% More definitions
\usepackage{showkeys}
\usepackage{mathtools}
%\usepackage{multirow}
%\usepackage{appendix}



\author{Sylvain Colin \& Gaspard FÃ©rey}
\title{The Sidelnikov-Shestakov's Attack applied to the Chor-Rivest Cryptosystem}

\begin{document}

\maketitle
\tableofcontents


\begin{abstract}

In this article, we discuss about the Sidelnikov-Shestakov attack on cryptosystems based on Reed-Solomon codes. Then we describe how this algorithm can be used to improve the attack to the Chor-Rivest Cryptosystem proposed by Vaudenay \cite{Vau01}.

\end{abstract}



\newpage
\section{Introduction}
\label{sec:intro}

Niederreiter and McEliece cryptosystem \cite{NiederH86} was one of the first to use randomization in the encryption process. Indeed, in such a scheme, the encrypter uses a random error to prevent attacks on the codeword. This codeword is then decrypted using an error-correcting Reed-Solomon code. This algorithm has never gained much acceptance in the cryptographic community, but is a candidate for "post-quantum cryptography".

In 1992, Sidelnikov and Shestakov suggest an attack \cite{SidelShes92} on the public key of this cryptosystem using equivalences between private keys.

The Chor-Rivest cryptosystem \cite{ChorRiv88} is a public key knapsack system which has been broken.  However, it took longer to break than most, and is a very elegant use of finite fields.

The first efficient attack for the proposed parameters (i.e., $p \simeq 200$, $h \simeq 24$) has been obtained by Vaudenay in 2001, assuming $h$ has a small factor.


\subsection{Our Work}
In this article, we first describe the Niederreiter and McEliece cryptosystem and present the original Sidelnikov and Shestakov's attack. We use here the echelon form of the public key as suggested by Wieschebrink \cite{Wiesch}. This gives an easy algorithm to attack such a scheme.

On a second part, we focus on the Chor-Rivest cryptosystem and show some similarities between the "known $g_{p^r}$ attack" introduced by Vaudenay and the Sidelnikov-Shestakov attack. This allows us to describe an algorithm for a "known $g_{p^r}$ attack" which doesn't require $r$ to be as big as in Vaudenay's article. In particular the term $p^{\sqrt{h}}$ in Vaudenay's complexity corresponding to an exhaustive research can be reduced to $p^{\log p}$ assuming we have $h \simeq \frac{p}{\log p}$ as suggested in Chor and Rivest's article and $h$ has very small factors (around $\log p$). That last point should be verified since the scheme can only be used efficiently when $h$ has a lot of divisors in order to be able to compute discrete logarithms for the public key.



\newpage
\section{Preliminaries}
\label{sec:Prel}


\subsection{A cryptosystem based on Reed-Solomon codes}
\subsubsection{Key generation}

We study here the public-key cryptosystem introduced first by Niederreiter and McEliece \cite{NiederH86} and based on generalized Reed-Solomon codes.

Let $\F_q$ be a finite field with $q = p^h$ elements and $\F = \F_q \cup \{ \infty \}$, where $\infty$ has usual properties ( $1/\infty = 0$, etc). We call $G$ the following matrix:
$$ G(\alpha_1, \ ... \ , \alpha_n, z_1, \ ... \ , z_n) := \left(
\begin{array}{cccc}
z_1 \alpha_1^0 &  z_2 \alpha_2^0 & \cdots & z_n \alpha_n^0 \\
z_1 \alpha_1^1 &  z_2 \alpha_2^1 & \cdots & z_n \alpha_n^1 \\
 & & \ddots & \\
z_1 \alpha_1^{k-1} &  z_2 \alpha_2^{k-1} & \cdots & z_n \alpha_n^{k-1}
\end{array}
\right) \in \mathcal{M}_{\F}(k,n) $$
where $\alpha_i \in \F$ and $z_i \in \F_q\backslash\{0\}$ for all $i \in \{1,...,n\}$.
The codes generated by such matrices are called Generalized Reed-Solomon (GRS) codes.

The cryptosystem is also based on a random nonsingular matrix $H$ of size $k\times k$ with coefficients in $\F_q$. Finally, we call $M$ the matrix of size $k\times n$ defined by $M=H.G(\alpha_1, \ ... \ , \alpha_n, z_1, \ ... \ , z_n)$.
It is clear that $M$ has the following general form :
$$ M := \left(
\begin{array}{cccc}
z_1.f_1(\alpha_1) &  z_2.f_1(\alpha_2) & \cdots & z_n.f_1(\alpha_n) \\
z_1.f_2(\alpha_1) &  z_2.f_2(\alpha_2) & \cdots & z_n.f_2(\alpha_n) \\
 & & \ddots & \\
z_1.f_k(\alpha_1) &  z_2.f_k(\alpha_2) & \cdots & z_n.f_k(\alpha_n) \\
\end{array}
\right)$$
where $f_i$ is a polynomial of degree at most $k-1$.

In the considered cryptosystem, the secret key consists of the set $\{\alpha_1,... ,\alpha_n\}$, the set $\{z_1,... ,z_n\}$ and the random matrix $H$.

The public key is given by the representation of the field $\F_q$ (ie. the polynomial used to define $\F_q$ over $\F_p$), the matrix $M$ and the integer $t=\lfloor\frac{n-k}{2}\rfloor$.

\subsubsection{Encryption and Decryption}
The codewords are then the vectors $c=b.M$ where $b\in\F_q^k$. So, the different codewords have necessarily the following form :

$$c=(z_if_c(\alpha_i))_{1\leq i\leq n}$$ where $f_c$ is a polynomial whose degree is at most $k-1$.

Thus, given a message to send, which is actually a vector $b$ of $\F_q^k$, one will have to transmit the vector $b.M + e$ where $e$ is a random vector of $\F_q^n$ with Hamming weight at most $t=\lfloor\frac{n-k}{2}\rfloor$.
Since a GRS code correct $\lfloor\frac{n-k}{2}\rfloor$ errors, this property remains true for $M$. Indeed, $b.M$ remains a codeword of the GRS code, since it is the codeword obtained applying the GRS code to $b.H$.
So, in order to decrypt the message, we first compute $b'=b.H$, finding the closest codeword from the received message, using for example the Berlekamp-Welch algorithm.
Then, we compute $b'.H^{-1}$ to get the original message.

However, the original message can not be easily recovered when not knowing the GRS code used in the secret key.

\subsection{Equivalence between Reed-Solomon codes}

Sidelnikov and Shestakov show \cite{SidelShes92} that for all $a \in \F_q\backslash\{0\}$ and $b \in \F_q$, there exists $H_1, H_2, H_3 \in \mathcal{M}_{\F_q}(k,k)$ nonsingular, $(c_1,... ,c_n) \in \F_q\backslash\{0\}^{n}$ and $(d_1,... ,d_n) \in \F_q\backslash\{0\}^{n}$ such that:
\begin{equation}
H_1.G(a\cdot\alpha_1 + b, \ ... \ , a\cdot \alpha_n + b, c_1z_1, \ ... \ , c_n z_n) &=& G(\alpha_1, \ ... \ , \alpha_n, z_1, \ ... \ , z_n) \\
\label{eq1}
\end{equation}
\begin{equation}
H_2.G\left( \frac{1}{\alpha_1}, \ ... \ , \frac{1}{\alpha_n}, d_1z_1, \ ... \ , d_n z_n \right) &=& G(\alpha_1, \ ... \ , \alpha_n, z_1, \ ... \ , z_n) \\
\label{eq2}
\end{equation}
\begin{equation}
H_3.G\left( \alpha_1, \ ... \ , \alpha_n, a\cdot z_1, \ ... \ , a\cdot z_n \right) &=& G(\alpha_1, \ ... \ , \alpha_n, z_1, \ ... \ , z_n)
\label{eq3}
\end{equation}
This means that for any cryptosystem $M = H.G(\alpha_1, \ ... \ , \alpha_n, z_1, \ ... \ , z_n)$, for any birationnal transformation
$$ \phi : x \mapsto \frac{ax+b}{cx+d}$$
there exist a nonsingular matrix $H_{\phi}$ and a vector $(z'_1,... ,z'_n) \in \F_q\backslash\{0\}^{n}$ such that:
$M = H_{\phi}.G(\phi(\alpha_1), \ ... \ , \phi(\alpha_n), z'_1, \ ... \ , z'_n)$$ and by using the unique transformation $\phi$ that maps $(\alpha_1, \alpha_2, \alpha_3)$ to $(0,1,\infty)$, we get that for any cryptosystem $M = H \A(\alpha_1, \ ... \ , \alpha_n, z_1, \ ... \ , z_n)$, $M$ can be uniquely written
$$ M = H' \A(0, 1, \infty, \alpha'_4, \ ... \ , \alpha'_n, z'_1, \ ... \ , z'_n) $$
with $H'$ nonsingular, $z'_i \neq 0$ and $\alpha_i$ distincts elements of $\F_q-\{0, 1, \infty)$.

So, when $M$ is given, it is impossible to compute the original matrices $\A$ and $H$ since many pairs of such matrices lead to the same public matrix $M$. However, computing an equivalent pair is sufficient
since it will allow to decipher the messages as well as the original secret pair of matrices. So, the attack will consist of finding $H$ and $\A(0, 1, \infty, \alpha'_4, \ ... \ , \alpha'_n, z'_1, z'_2, \ ... \ , z'_n)$, equivalent to the original pair. 
We can also assume that $z'_1=1$. Indeed, if we multiply all the elements $z'_i$ by a factor $a \in \F_q$ and all the elements of the matrix $H$ by $a^{-1}$, the resulting matrix $M$ will be the same.


\newpage
\section{The Sidelnikov-Shestakov Attack}
\label{sec:SSattack}

The attack of Sidelnikov-Shestakov consists of the following steps.
\bigskip

First we assume that the public key is as described in the previous section :
$$ M = H' \A(0, 1, \infty, \alpha'_4, \ ... \ , \alpha'_n, 1, z'_2, \ ... \ , z'_n) $$

We compute then the echelon form of $M$.
$$ E(M) = 
\left(
\begin{array}{ccccccc}
1 & 0 & \cdots & 0 & b_{1,k+1} & \cdots & b_{1,n} \\
0 & 1 & \cdots & 0 & b_{2,k+1} & \cdots & b_{2,n} \\
  &   & \ddots &   & \vdots &   & \vdots \\
0 & \cdots & 0 & 1 & b_{k,k+1} & \cdots & b_{k,n}
\end{array}
\right) = H'' \cdot M
$$

Since the echelon form can be computed only with left multiplication of the matrix M, the $k$ lines of $E(M)$ are codewords. As a consequence, if we call $f_i$ the polynomial associated to the $i^{th}$
line, we have :
\begin{itemize}
\item $\forall$  $1\leq i\leq k, f_i(\alpha_i)=1 $
\item $\forall$  $1\leq i\neq j\leq k, f_i(\alpha_j)=0 $
\item $\forall$  $1\leq i\leq k$ $\forall$ $k+1\leq j\leq n$, $f_i(\alpha_j)=b_{i,j} $
\end{itemize}
So, since all the $\alpha_i$ are different, the polynomial $f_i$ has $k-1$ simple roots. As a consequence, $b_{i,j}\neq0$ for all $1\leq i\leq k$ and $k+1\leq j\leq n$. Moreover, we know the general 
form of the polynomial $f_i$ :
$$f_i(X) = c_i.\prod_{1\leq j\leq k, i\neq j} (X-\alpha_j)$$ where $c_i \in \F\backslash{0}$.

For $2 \leq k \leq n-2$, this attack works with a complexity of ...


\newpage
\section{Application to the Chor-Rivest Cryptosystem}
\label{sec:CRcrypt}

\subsection{Notations}

From now on, $p$ is a power of a prime and $q := p^h$ with $h$ integer. We call $\F_n := \text{GF}(n)$ the finite field of order $n$. We often refer in this article to $\F_p$ and $\F_{p^r}$ (with $r$ a divisor of $h$) both sub-fields of $\F_q$. The elements of $\F_p$ are $\{ \alpha_0, ... , \alpha_{p-1} \}$.

When $n \in \N$, we define the weight of $n$ in base $p$ as follow
$$ w_p : u = \sum_{i=0}^{d} u_i p^i \longmapsto \sum_{i=0}^{d} u_i \ \ \ \ \ \text{ where }  \ 0 \leq u_i \leq p-1 $$

\subsection{The Chor-Rivest Cryptosystem}

The Chor-Rivest cryptosystem is a public key knapsack scheme using the 


The secret key consist of
\begin{itemize}
\item an element $t \in \GF{q}$ with algebraic degree $h$.
\item a generator $g$ of $\GF{q}^{*}$.
\item an integer $0 \leq d < q$.
\item a permutation $\pi$ of $\{ 0, ... , p-1 \}$.
\end{itemize}

Public keys consist of all
$$ c_i := d + \log_g(t + \alpha_{\pi(i)}) \mod q-1 $$

The message consists in a bitstring $m = [m_0...m_{p-1}]$ of length $p$ and weight $h$ : $\sum_i m_i = h$. The ciphertext is
$$ E(M) := \sum_{i=0}^{p-1} m_i c_i \mod q-1 $$
To decipher this message, we compute
$$ g^{E(M) - hd} =  \prod_i \left( t + \alpha_{pi(i)}\right)^{m_i} $$
whose factorization leads to the message $m$.


\subsubsection{Link with Reed-Solomon codes}

Trying to attack this cryptosystem show some relations between this problem and the previous one studied in section \ref{sec:Prel}. In particular we have the following theorem.

\begin{theorem}
\label{thm:link}
Let $2 \leq k \leq p-2$.
Suppose there exists $(Q_i)_{0 \leq i \leq k-1}$ $k$ polynomials of $\GF{p}[X]$ linearly independent with degree smaller than $k-1$.
Suppose the evaluations $m_{i,j} := Q_i(\alpha_{\pi(j)})$ is known for all $i$ and $j$.
Then the permutation $\pi$ can be recovered in polynomial time using a Sidelnikov-Shestakov attack on the matrix $M = (m_{i,j})_{i,j} \in \mathcal{M}_{k,p}(\GF{p})$.
\end{theorem}
\begin{proof}
We suppose here that one of the $Q_i$ has a degree exactly $k$.
Then we write the square non singular matrix $H = (h_{i,j}) \in \mathcal{M}_k(\GF{p})$ of the coefficients of the $Q_i$
$$ Q_i(X) = \sum_{j=0}^{k-1} h_{i,j} X^j $$
If we still consider
$$ \A_k := \left( \alpha_{\pi(j)}^i \right)_{0 \leq i < k, 0 \leq j \leq p-1} \in \mathcal{M}_{k,p}(\GF{p})$$
We have the equality
$$ H \cdot \A_k = M$$
with $H$ non singular and since $k \leq p-2$, this is exactly the public key of a cryptosystem based on the Reed-Solomon codes described in Section~\ref{sec:Prel}.
$$
\begin{array}{ccl}
& \left( \begin{array}{ccccc}
1&\cdots&1&\cdots&1\\
\alpha_1&\cdots&\alpha_j&\cdots&\alpha_p\\
\vdots&&\vdots&&\vdots \\
\alpha_1^{k-1}&\cdots&\alpha_j^{k-1}&\cdots&\alpha_p^{k-1}
\end{array} \right) =: \A_k \\
H := \left( \begin{array}{ccc}
-&Q_1&-  \\
&\vdots& \\
-&Q_i&-  \\
&\vdots& \\
-&Q_k&-
\end{array} \right) &
\left( \begin{array}{ccccc}
Q_1(\alpha_1)&&\cdots&&Q_1(\alpha_p)\\
\vdots&&\vdots&&\vdots \\
Q_i(\alpha_1)&&m_{i,j}&&Q_i(\alpha_p)\\
\vdots&&\vdots&&\vdots \\
Q_k(\alpha_1)&&\cdots&&Q_k(\alpha_p)
\end{array} \right) =: M \\
\end{array}
$$
\end{proof}

So a possible way to attack the Chor-Rivest cryptosystem would be to find the evaluations of enough small degree polynomials in the $\alpha_{\pi(i)}$.



\subsection{A First Attack using Reed-Solomon codes}


When we attack this cryptosystem, we can consider a generator $g_0 = g^u$ with $u$ unknown and $\gcd(u, q-1) = 1$ we then have
$$ g_0^{c_i} = \left( g^d \left( t + \alpha_{\pi(i)} \right) \right)^u = \left(A + \alpha_{\pi(i)} \cdot B\right)^u$$
We can then consider that the secret key is
\begin{itemize}
\item $A \in \F_q$.
\item $B \in \F_q$ such that $t = A\cdot B^{-1}$ has algebraic degree $h$.
\item $0 < u < q-1$ prime with $q-1$.
\item the permutation $\pi$ of $\{ 0, ... , p-1 \}$.
\end{itemize}
and public key consists in all the
$$ d_i := \left(A + \alpha_{\pi(i)} \cdot B\right)^u \in \F_q$$
The ciphertext becomes
$$ E'(M) := \prod_{i=0}^{p-1} d_i^{m_i} = g^{uE(M)} = B^{uh} \left( \prod_i \left( t + \alpha_{pi(i)}\right)^{c_i} \right)^u$$
Knowing $u$, $B$ and $h$, it is easy to compute from $E'(M)$, the following quantity
$$ \prod_i \left( t + \alpha_{pi(i)}\right)^{c_i} $$
which allow us to retrieve all the $c_i$.



We have for all $j$
$$ g^{c_j} = g^d \cdot (t + \alpha_{\pi(j)} ) = A + \alpha_{\pi(j)} \cdot B $$
where $\alpha_{\pi(j)} \in \GF{p}$ and $A$ and $B$ are elements of $\GF{p^h}$.

A naive attack would be then to try to guess at random the generator $g$. We will see that although finding the precise $g$ is very unlikely, there is a family of generators that can still allow us to retrieve $\pi$.

\subsubsection{Small powers of $g$}

As an attempt to guess $g$, we can choose a random generator $g_0$ of $\GF{q}^{*}$. We have $g_0 = g^u$ and
$$ g_0 ^{c_j} = (A + \alpha_{\pi(j)} \cdot B)^u $$
if we write this quantity in a certain base $(e_i)_{1 \leq i \leq h}$ of $\GF{p^h}$, we notice that each coordinate is a polynomial $Q_i$ in the $\alpha_{\pi(j)}$.
$$ g_0^{c_j} = \sum_{i=1}^h Q_i(\alpha_{\pi(j)}) e_i $$
where $Q_i$ has its coefficients in $\GF{p}$.
$Q_i$ depends on $A$, $B$, $u$ and obviously on $i$. However, $Q_i$ does not depend on $j$.

Besides, we have
\begin{itemize}
\item $\deg Q_i \leq u$
\item $\deg Q_i < p$ since $\alpha_{\pi(j)}^p = \alpha_{\pi(j)}$.
\end{itemize}

This means that we have access to the evaluations in the $\alpha_{\pi(j)}$ of $h$ polynomials of degree smaller than $u$. According to Theorem~\ref{thm:link}, a sufficient condition for this attack to work is $u \leq h-1 \leq p-3$. The last inequality is  always true for a big enough instance of the cryptosystem since $h$ is supposed to be chosen close to $p / \log p$. However there are only $h-1$ different elements of $\GF{p^h}$ fulfilling the first inequality.

Considering all these acceptable generators only slightly improves the exhaustive research of $g$ by a factor of $h$.


\subsubsection{Wider set of acceptable generators}

We can notice that if $u = u'p$,
$$ g_0^{c_j} = (A + \alpha_{\pi(j)} \cdot B)^{u'p} = (A^p + \alpha_{\pi(j)} \cdot B^p)^{u'} $$
and the coordinates of this quantity are polynomials of degree $u'$ in $\alpha_{\pi(j)}$.
This also means that if $u$ is written $u = \sum_{i=0}^{h-1} u_i p^i$ in base $p$, then
$$ g_0^{c_j} = \prod_{i=0}^{h-1} (A^{p^i} + \alpha_{\pi(j)} \cdot B^{p^i} )^{u_i} $$
whose coordinates are a polynomial of degree $w_p(u) := \sum_{i=0}^{h-1} u_i$ in the $\alpha_{\pi(j)}$.

This mean that all $u$ such that $w_p(u) < h$ allow to retrieve the permutation and break the cryptosystem.
The number of such $u$ is
$$ \left( \binom{h+1}{h-1} \right) = \binom{2h}{h-1} =\Theta\left( 4^h \sqrt{h} \right) $$
This is a drastic improvement in the exhaustive research of $g$. However this remains quite small compared to the number $\phi(p^h-1)$ of different generators in $\GF{p^h}$ which is comparable to $p^h$.




\newpage
\section{Vaudenay attack}
\label{sec:Vau}

The previous attack requires to find a generator of $\F_q$ among the elements that can be written $g^u$ with $w_p(u) < h$. Since there are very few of such elements compared to the $\phi(q-1)$ different generators of $\F_q$, Vaudenay suggests \cite{Vau01} to consider a generator $g_{p_r}$ of the subfield $\F_{p^r} \subseteq \F_{p^h}$. He introduces the following theorem
\begin{theorem}
For any factor $r$ of $h$, there exists a generator $g_{p^r}$ of the multiplicative group of the subfield $\F_{p^r}$ of $\F_q$ and a polynomial $Q$ with degree $h/r$ whose coefficients are in $\F_{p^r}$ and such that $-t$ is a root and for all $j$ , we have $Q(\alpha_{\pi(j)}) = g_{p^r}^{c_j}$.
\end{theorem}
\begin{proof}
The expression of such a polynomial is given by
$$ Q(X) = g_{p^r}^d \prod_{i=0}^{h/r-1} \left( X + t^{p^{ri}} \right) $$
where $g_{p^r} = g^{\frac{q-1}{p^r-1}}$. 
\end{proof}

If we chose a base $(e_i)_{1 \leq i \leq r}$ of $\GF{p^r}$ (seen as a $\F_p$-vector space), we can write the coefficients of $g_{p^r}^{c_j}$ in this base as polynomials $Q_i$ in $\alpha_{\pi(j)}$. We get
$$ g_{p^r}^{c_j} = \sum_{i=1}^r Q_i(\alpha_{\pi(j)}) e_i $$
with $\deg Q_i \leq h/r$. We get the evaluation of $r$ polynomials of degree smaller than $h/r$.

This means that instead of searching a generator among the approximately $p^h$ generators of $\F_q$, we could search only within $\F_{p^r}$ with $r$ as small as possible. We notice that to be able to apply Theorem~\ref{thm:link}, we must have $h/r < r$. This yields the following theorem.

\begin{theorem}
When $r > \sqrt{h}$, there exists a polynomial "known $g_{p^r}$" attack on the Chor-Rivest cryptosystem.
\end{theorem}

This theorem is basically the main result from Vaudenay's article \cite{Vau01}. It states that to attack the Chor-Rivest cryptosystem, one can only search for the generator $g_{p^r}$ among $\phi(p^r-1)$ (which is about $p^r$) possible choices instead of the exhaustive research for $g$ (around $p^h$ choices).

However the "known $g_{p^r}$ attack" suggested in Vaudenay's article can be improved in two ways.

\begin{itemize}
\item First it is only polynomial when $r > \sqrt{h}$. We will see that using a Reed-Solomon attack, we can still retrieve $\pi$ in polynomial time provided we manage to get enough linearly independent polynomials in the $\alpha_{\pi(j)}$ which is possible even for small values of $r$ using $g_{p^r}^u$ with $u$ small enough.
\item Besides, the Reed-Solomon attack doesn't require the knowledge of all the $c_j$. Only $O(h)$ (or a little more when considering the attack for $r$ small) of them. So actually only a small proportion of them is enough. This makes this attack strong.
\end{itemize}




\subsection{Generating more rows...}

We now describe a "known $g_{p^r}$" attack which allow the divisor $r$ of $h$ to be far smaller.
We still consider the expression of elements of $\F_{p^r}$ in a given base $(e_i)_{1 \leq i \leq r}$.


When we find $g_{p^r}$ such that $g_{p^r}^{c_j} = Q(\alpha_{\pi(j)})$ with $\deg Q \leq h/r$, we only have $r$ polynomials corresponding to the $r$ different coordinates of $g_{p^r}^{c_j}$ in a certain base of $\F_{p^r}$. Being able to generate more polynomials would allow to chose a lower $r$ and improve drastically the attack.

We could consider now the coordinates in the equation $Q^u(\alpha_{\pi(j)}) = g_{p^r}^{u c_j}$ for $u \in [1,p^r-1]$. This yields again $r$ polynomials of degree smaller than $u h/r$. Actually, since $P \mapsto P^p$ let the degree invariant we know that the degree of $Q^u$ is actually at most $w_p(u) h / r$.

To generate more polynomials, we could then decide to consider all the equations $Q^u(\alpha_{\pi(j)}) = g_{p^r}^{u c_j}$ for all $u \in U_w^{(r)} := \{ u \in [1,p^r-1] | w_p(u) \leq w \}$
This yields $r \cdot |U_w^{(r)}|$ polynomials of degree at most $wh/r$.

Besides, assuming $w \gg r$, the number of such polynomials can be up to
$$ | U_w^{(r)} | = \left( \binom{r+1}{w} \right) = \binom{r+w+1}{w} = \binom{r+w+1}{r+1} = \Theta\left(\frac{w^{r+1}}{(r+1)!}\right) .$$
This means that we can choose $r$ far smaller than $\sqrt{h}$. Indeed, even if we consider polynomials of higher degree ($wh/r$), the number of such polynomials we can get is far greater than $r$ and we can hope that if we choose $w$ high enough, we can get enough different polynomials to use a Sidelnikov-Shestakov attack.


Unfortunately, these polynomials are strongly linearly dependent.
For example, the coordinates of $g_{p^r}^{p c_j}$ are linearly dependent on the coordinates of $g_{p^r}^{c_j}$. Indeed, when decomposed in a normal base of $\F_{p^r}$, these two sets of vectors of coordinates only differs by a rotation.





\section{Simulation and expected complexity}
\label{sec:Simul}

\subsection{A first example}

In order to demonstrate how the algorithm presented in Section~\ref{sec:Vau}, we run a simulation of the exhaustive search of $g_{p^r}$ with the following parameters
\begin{itemize}
\item $p = 197$, $h = 24$, $r = 3 < \sqrt{h}$.
\item We define $\F_q$ as the quotient of $\F_p[X]$ by the polynomial
\begin{eqnarray*}
X^{24} &+& 192X^{23} + 152X^{22} + 25X^{21} + 75X^{20} + 67X^{19} + 92X^{18} + 23X^{17} + 45X^{16} + 97X^{15} \\
 &+& 2X^{14} + 21X^{13} + 106X^{12} + 130X^{11} + 128X^{10} + 136X^9 + 195X^8 + 95X^7 + 155X^6 \\
 &+& 34X^5 + 51X^4 + 180X^3 + 97X^2 + 23X + 87
\end{eqnarray*}
\item We choose $g := X + 2$ the private multiplicative generator.
\item We compute
\begin{eqnarray*}
g_{p^r} &=& g^{\frac{p^h-1}{p^r-1}} \\
&=& 153X^{23} + 168X^{22} + 167X^{21} + 45X^{20} + 128X^{19} + 68X^{18} + 103X^{17} + 11X^{16}\\
&&+ 139X^{15} + 190X^{14} + 75X^{13} + 73X^{12} + 190X^{11} + 64X^{10} + 173X^9 + 34X^8 \\
&&+ 88X^7 + 30X^6 + 139X^5 + 146X^4 + 111X^3 + 80X^2 + 136X + 48\\
\end{eqnarray*}
\item We choose different values for $d$, $t$ and $\pi$, the results remain the same.
\item We choose the base $\left(g_{p^r}, g_{p^r}^p, g_{p^r}^{p^2} \right)$ for the $\F_p$-vector space $\F_{p^r}$ (but this is of no influence on the results).
\item We choose $(u_i)_{1\leq  i \leq 11} = (1,2,p+1,3,2p+1,p+2,4,p+3,3p+1,2p+2,2p^2+p+1)$\\
We have $w_p(u_i) \leq 4$ so the coordinates of $g_{p^r}^{u_i c_j}$ are polynomials of degree smaller than $4 h/r+1 = 33$ in the $\alpha_{\pi(j)}$.
\end{itemize}
As a result, we obtain $11 \times 3 = 33$ lines of coordinates linearly independent (the simulation is the verification of this independence). This would allow the attack to retrieve the permutation $\pi$ using the attack on the cryptosystem based on Reed-Solomon codes.

This proves that it is possible to duplicate the number of lines at the expense of the degree of the polynomials considered. Therefore the condition $r \geq \sqrt{h}$ is not absolutely necessary and we can hope to get a (far) smaller lower bound on $r$.

On the following tabular, we present the results of several simulations for different value of $p$, $h$. Each time, we choose the smallest value for $r$ that allow an attack on the system. We display here the maximum weight $w$ chosen for the exponents $u_i$ of $g_{p^r}$ and the number of linearly independent lines these $g_{p^r}^{u_i}$ allow to generate (should be $w\cdot \frac{h}{r} +1$).


\begin{tabular}{|c|c|c|c|l|}
\hline
$p$ & $h$ & $r$ & $w_p(u_i)$ & Number of linearly independent lines  \\
\hline
197 & 24 & 2 & $w$ & $\frac{w(w+3)}{2} < 12w+1$ Attack impossible. \\
\hline
197 & 24 & 3 & 4 & 33\\
\hline
197 & 24 & 4 & 2 & 13\\
\hline
197 & 24 & $r \geq 6$ & 1 & $1 + h/r$ \\
\hline
193 & 36 & 2 & $w$ & $\frac{w(w+3)}{2} < 18w+1$ Attack impossible. \\
\hline
193 & 36 & 3 & 6 & 73\\
\hline
193 & 36 & 4 & 3 & 28\\
\hline
193 & 36 & 6 & 2 & 13\\
\hline
193 & 36 & $r \geq 9$ & 1 & $1 + h/r$ \\
\hline
251 & 60 & 2 & $w$ & $\frac{w(w+3)}{2} < 30w+1$ Attack impossible. \\
\hline
251 & 60 & 3 & 8 & 161\\
\hline
251 & 60 & 4 & 4 & 61\\
\hline
251 & 60 & 5 & 3 & 37\\
\hline
251 & 60 & 6 & 2 & 21\\
\hline
251 & 60 & $r \geq 10$ & 1 & $1 + h/r$ \\
\hline
\end{tabular}

When we choose, $r = 2$ and $w_p(u_i) \leq w$, the number of linearly independent lines is $\frac{w(w+3)}{2}$. This does not allow to attack the cryptosystem since to have $\frac{w(w+3)}{2} \geq 12w+1$, we would need $w \geq 22$ and if $w_p(u_i) = 2$, then the degree of the corresponding polynomials is $22 \times 12+1 = 265 > 197$.

Regarding that last set of examples, the Chor-Rivest attack would require to do an exhaustive research on approximately $251^{10}$ different possible generators of $\F_{p^{10}}$. With our approach, the cryptosystem can be attacked using the right generator $g_{p^3}$ of $\F_{p^3}$. The research is clearly a lot faster.



\subsection{Number of linearly independent polynomials}

Let $r$ be a divisor of $h$, we call $u_w$ the number of linearly independent rows of coordinates we can get using the coordinates of $g_{p^r}^{uc_j}$ for all $u$ such that $w_p(u) \leq w$.

We have $u_0 = 1$ obviously because using $g_{p^r}^0$, we only get one row filled with 1.

We also have $u_1 = r+1$ because we can only get $r$ more lines using $g_{p^r}$ corresponding to the $r$ different coordinates of $g_{p^r}^{c_j}$ in $\F_{p^r}$. The coordinates given by the generator $g_{p^r}^{p^i}$ are the same as those given by $g_{p^r}$ in a normal base. This mean that whatever the base chosen, they are at least linearly dependent from each other and so using $g_{p^r}$ doesn't allow to generate more useful polynomials.

\subsubsection{Postulate}


%\begin{itemize}
%\item For $w \leq h/r$, $u_w = u_{w-1} + \binom{w+r-1}{r-1}$
%\item For $w > h/r$, $u_w = u_{w-1} + h/r$.
%\end{itemize}
%
%We could postulate that for all $w \leq h/r$,
%$$ u_w = \sum_{v=0}^{w} \binom{v+r-1}{r-1} = \binom{w+r}{r} $$
We define $\upsilon(w)$ as
$$ \upsilon(w) := \begin{cases}
\binom{w+r}{r} & \mbox{if } w \leq h/r \\
\upsilon\left(\frac{h}{r}\right) + n \frac{h}{r} & \mbox{if } w = h/r + n
\end{cases} $$

We notice experimentally the following behavior of $u_w$
$$ u_w = \min \left( \upsilon(w), w\frac{h}{r} + 1 , p \right)$$

This behavior has been observed for the following range of parameters :

\begin{center}
\begin{tabular}{|c|c|c|}
\hline
$r$ & $w$ 	& $h/r$ \\
\hline
2	& 1-8	& 1-8	\\
\hline
3	& 1-17	& 1-17, 30 \\
\hline
4	& 1-17	& 1-17, 30 \\
\hline
\end{tabular}
\end{center}



\subsection{Optimum choice for $r$}

We suppose that we have found $r$ allowing to attack a Chor-Rivest cryptosystem. Being able to perform a Sidelnikov-Sjestakov attack imposes that there exists $w$ such that
\begin{eqnarray*}
wh/r+1 &\leq & p-2 \\
wh/r+1 &\leq & u_w 
\end{eqnarray*}
We choose the biggest $w$ verifying the first condition to have the weakest condition on $r$ : $w = \lfloor r \frac{p-3}{h} \rfloor $. Besides we know that $h$ is suppose to be chosen around $\frac{p}{\log p}$. This means that we have $w = \Theta(r \log p) \geq C r \log p$.

We suppose that we remain in the domain $w \leq h/r$ and that the postulate in the Section~\ref{sec:Simul} is true. The second condition is then easily equivalent to
$$ \upsilon(w) = \binom{w+r}{r} \geq w\frac{h}{r}+1 $$
and since
$$ \binom{w+r}{r} \geq \frac{w^r}{r!} \ \ \text{ and } \ \ p \geq w\frac{h}{r}+1 $$
a sufficient condition would be



%\begin{eqnarray*}
%C\frac{w^r}{r!} &\geq& w \frac{h}{r} \\
%\Leftrightarrow C w^{r-1} &\geq& h\cdot (r-1)! \\
%\Leftarrow C w^{r-1} &\geq& h (r-1)^{r-1} \\
%\Leftarrow w &\geq& (r-1) \left(\frac{h}{C}\right)^{\frac{1}{r-1}} \geq C' r h^{\frac{1}{r-1}}
%\end{eqnarray*}
%This yield
%\begin{eqnarray*}
%C' h \cdot h^{\frac{1}{r-1}} &\leq& p-3 \\
%\frac{\log h}{r-1} &\leq& \log (p-3) - \log h + C'' \\
%r-1 &\geq& \frac{\log h}{\log(p-3) - \log h + C''} 
%\end{eqnarray*}

\begin{eqnarray*}
\frac{w^r}{r!} &\geq& p \\
\Leftarrow \ \ \ \ \ \ \ \ C r^r (\log p)^r &\geq& p \cdot r! \\
\Leftarrow (e \log p)^r &\geq& \frac{p}{C \sqrt{2\pi r}} \geq C' p \\
\Leftarrow r &\geq& \frac{\log p + C''}{\log \log p + 1} \sim \frac{\log p}{\log \log p}
\end{eqnarray*}
This mean that the exhaustive research can be done in time $O\left( p^{\frac{\log p}{\log \log p}} \right)$, far faster than $O\left(p^{\sqrt{\frac{p}{\log p}}}\right)$.

The condition $r w \leq h$ yields an upper bound on the $r$.
$$ C' r^2 \leq \frac{p}{\log^2 p}  $$
which is asymptotically always verified given the upper bound on $r$ found.




\section{Conclusions}

We can notice that this attack on Chor-Rivest cryptosystem is only effective when $h$ possesses a small factor. For example, L. Hernandez Encinas \textit{et alii} \cite{Enc04} suggest to use $h$ prime. Such a cryptosystem remains however useless nowadays essentially because of the complexity of the discrete logarithm problem.





\bibliographystyle{abbrv}
\bibliography{references}
\newpage
\appendix
\end{document}
